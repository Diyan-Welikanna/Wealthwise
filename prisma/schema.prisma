generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(100)
  email        String        @unique @db.VarChar(100)
  password     String        @db.VarChar(255)
  phone        String?       @db.VarChar(20)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  incomes      Income[]
  transactions Transaction[]
  budgets      UserBudget?

  @@map("users")
}

model Category {
  id                Int                 @id @default(autoincrement())
  name              String              @unique @db.VarChar(50)
  color             String              @db.VarChar(7)
  icon              String?             @db.VarChar(50)
  createdAt         DateTime            @default(now()) @map("created_at")
  transactions      Transaction[]
  recurringExpenses RecurringExpense[]

  @@map("categories")
}

model Income {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  income    Decimal  @db.Decimal(10, 2)
  month     DateTime @db.Date
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "income_user_id_fkey")
  @@map("income")
}

model UserBudget {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique @map("user_id")
  budget    String   @db.LongText
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_budgets")
}

model Transaction {
  id              Int      @id @default(autoincrement())
  userId          Int      @map("user_id")
  categoryId      Int      @map("category_id")
  amount          Decimal  @db.Decimal(10, 2)
  description     String?  @db.Text
  transactionDate DateTime @map("transaction_date") @db.Date
  transactionType String   @default("expense") @map("transaction_type") @db.VarChar(10)
  createdAt       DateTime @default(now()) @map("created_at")
  category        Category @relation(fields: [categoryId], references: [id])
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId], map: "transactions_category_id_fkey")
  @@index([userId], map: "transactions_user_id_fkey")
  @@map("transactions")
}

model RecurringExpense {
  id             Int      @id @default(autoincrement())
  userId         Int      @map("user_id")
  categoryId     Int      @map("category_id")
  amount         Decimal  @db.Decimal(10, 2)
  description    String?  @db.Text
  frequency      String   @db.VarChar(20) // daily, weekly, monthly, yearly
  nextOccurrence DateTime @map("next_occurrence") @db.Date
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  category       Category @relation(fields: [categoryId], references: [id])

  @@index([userId], map: "recurring_expenses_user_id_fkey")
  @@index([categoryId], map: "recurring_expenses_category_id_fkey")
  @@map("recurring_expenses")
}
