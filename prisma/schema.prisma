generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                     Int                     @id @default(autoincrement())
  name                   String                  @db.VarChar(100)
  email                  String                  @unique @db.VarChar(100)
  password               String                  @db.VarChar(255)
  phone                  String?                 @db.VarChar(20)
  riskTolerance          String                  @default("moderate") @map("risk_tolerance") @db.VarChar(20) // conservative, moderate, aggressive
  currency               String                  @default("INR") @db.VarChar(3) // ISO 4217 currency codes
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  incomes                Income[]
  transactions           Transaction[]
  budgets                UserBudget?
  investmentPortfolio    InvestmentPortfolio[]
  investmentTransactions InvestmentTransaction[]
  goals                  Goal[]

  @@map("users")
}

model Category {
  id                Int                 @id @default(autoincrement())
  name              String              @unique @db.VarChar(50)
  color             String              @db.VarChar(7)
  icon              String?             @db.VarChar(50)
  createdAt         DateTime            @default(now()) @map("created_at")
  transactions      Transaction[]
  recurringExpenses RecurringExpense[]

  @@map("categories")
}

model Income {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  income    Decimal  @db.Decimal(10, 2)
  month     DateTime @db.Date
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "income_user_id_fkey")
  @@map("income")
}

model UserBudget {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique @map("user_id")
  budget    String   @db.LongText
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_budgets")
}

model Transaction {
  id              Int      @id @default(autoincrement())
  userId          Int      @map("user_id")
  categoryId      Int      @map("category_id")
  amount          Decimal  @db.Decimal(10, 2)
  description     String?  @db.Text
  transactionDate DateTime @map("transaction_date") @db.Date
  transactionType String   @default("expense") @map("transaction_type") @db.VarChar(10)
  createdAt       DateTime @default(now()) @map("created_at")
  category        Category @relation(fields: [categoryId], references: [id])
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId], map: "transactions_category_id_fkey")
  @@index([userId], map: "transactions_user_id_fkey")
  @@map("transactions")
}

model RecurringExpense {
  id             Int      @id @default(autoincrement())
  userId         Int      @map("user_id")
  categoryId     Int      @map("category_id")
  amount         Decimal  @db.Decimal(10, 2)
  description    String?  @db.Text
  frequency      String   @db.VarChar(20) // daily, weekly, monthly, yearly
  nextOccurrence DateTime @map("next_occurrence") @db.Date
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  category       Category @relation(fields: [categoryId], references: [id])

  @@index([userId], map: "recurring_expenses_user_id_fkey")
  @@index([categoryId], map: "recurring_expenses_category_id_fkey")
  @@map("recurring_expenses")
}

model InvestmentPortfolio {
  id                     Int                     @id @default(autoincrement())
  userId                 Int                     @map("user_id")
  investmentType         String                  @map("investment_type") @db.VarChar(50) // stocks, bonds, mutual_funds, real_estate, crypto, fixed_deposit, gold
  name                   String                  @db.VarChar(100)
  units                  Decimal                 @db.Decimal(12, 4)
  buyPrice               Decimal                 @map("buy_price") @db.Decimal(10, 2)
  currentPrice           Decimal                 @map("current_price") @db.Decimal(10, 2)
  totalInvested          Decimal                 @map("total_invested") @db.Decimal(12, 2)
  currentValue           Decimal                 @map("current_value") @db.Decimal(12, 2)
  purchaseDate           DateTime                @map("purchase_date") @db.Date
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  user                   User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  investmentTransactions InvestmentTransaction[]

  @@index([userId], map: "investment_portfolio_user_id_fkey")
  @@map("investment_portfolio")
}

model InvestmentTransaction {
  id          Int                 @id @default(autoincrement())
  userId      Int                 @map("user_id")
  portfolioId Int                 @map("portfolio_id")
  type        String              @db.VarChar(10) // buy, sell
  units       Decimal             @db.Decimal(12, 4)
  pricePerUnit Decimal            @map("price_per_unit") @db.Decimal(10, 2)
  totalAmount Decimal             @map("total_amount") @db.Decimal(12, 2)
  date        DateTime            @db.Date
  createdAt   DateTime            @default(now()) @map("created_at")
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  portfolio   InvestmentPortfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([userId], map: "investment_transactions_user_id_fkey")
  @@index([portfolioId], map: "investment_transactions_portfolio_id_fkey")
  @@map("investment_transactions")
}

model Goal {
  id            Int      @id @default(autoincrement())
  userId        Int      @map("user_id")
  name          String   @db.VarChar(100)
  targetAmount  Decimal  @map("target_amount") @db.Decimal(12, 2)
  currentAmount Decimal  @default(0) @map("current_amount") @db.Decimal(12, 2)
  deadline      DateTime @db.Date
  category      String   @db.VarChar(50) // emergency_fund, vacation, house, car, retirement, education, wedding, other
  description   String?  @db.Text
  isCompleted   Boolean  @default(false) @map("is_completed")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "goals_user_id_fkey")
  @@map("goals")
}
